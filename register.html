<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register | MedDispense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Poppins', sans-serif; }</style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-white to-blue-50 h-screen flex items-center justify-center">

    <div class="bg-white/90 backdrop-blur-xl p-10 rounded-3xl shadow-2xl w-full max-w-md border border-white relative overflow-hidden">
        <div class="absolute -top-10 -right-10 w-32 h-32 bg-green-100 rounded-full blur-2xl opacity-50"></div>

        <h2 class="text-2xl font-bold text-slate-800 mb-2 text-center relative z-10">Join MedDispense</h2>
        <p class="text-center text-slate-400 text-sm mb-8 relative z-10">Create your caregiver account</p>
        
        <div class="space-y-4 relative z-10">
            <div class="relative">
                <i class="fa-solid fa-user-plus absolute left-4 top-4 text-slate-400"></i>
                <input id="regUser" type="text" placeholder="Choose Username" class="w-full pl-12 p-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-green-400 outline-none transition">
            </div>
            
            <div class="relative">
                <i class="fa-solid fa-key absolute left-4 top-4 text-slate-400"></i>
                <input id="regPass" type="password" placeholder="Choose Password" class="w-full pl-12 p-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-green-400 outline-none pr-10 transition">
                <button onclick="togglePass()" class="absolute right-3 top-3.5 text-slate-400 hover:text-green-600 transition">
                    <i id="eyeIcon" class="fa-solid fa-eye"></i>
                </button>
            </div>

            <button onclick="register()" class="w-full bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 text-white font-bold py-3.5 rounded-xl transition shadow-lg shadow-green-200 transform hover:-translate-y-0.5">
                Sign Up
            </button>

            <button onclick="window.location.href='index.html'" class="w-full text-slate-500 text-sm font-semibold hover:text-slate-800 mt-4">
                <i class="fa-solid fa-arrow-left mr-2"></i> Back to Login
            </button>
        </div>
    </div>

    <script>
        function togglePass() {
            const input = document.getElementById('regPass');
            const icon = document.getElementById('eyeIcon');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            }
        }

        async function register() {
            const username = document.getElementById('regUser').value.trim();
            const password = document.getElementById('regPass').value.trim();
            
            if(!username || !password) return alert("Please fill all fields!");

            try {
                const res = await fetch('http://localhost:5000/auth', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username, password, type: 'register' })
                });

                if(res.ok) {
                    // ALERT FIRST, THEN REDIRECT
                    alert("Account Created Successfully! Click OK to Login.");
                    window.location.href = 'index.html'; 
                } else {
                    alert("User already exists! Try a different username.");
                }
            } catch(e) { 
                alert("Server Error. Ensure node server.js is running."); 
            }
        }
    </script>
</body>
</html>